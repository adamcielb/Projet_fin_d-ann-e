#include <iostream>
#include <wiringPi.h>

#define REED_PIN 0  
const double FACTOR_MPH = 2.5;      // Facteur d'étalonnage en mph
const double FACTOR_KMH = 4.0225;   // Facteur d'étalonnage en km/h

volatile int pulse_count = 0;

void pulse_detected() {
    pulse_count++;  
}

int main() {
    wiringPiSetup();
    pinMode(REED_PIN, INPUT);
    pullUpDnControl(REED_PIN, PUD_UP);
    wiringPiISR(REED_PIN, INT_EDGE_FALLING, &pulse_detected);

    while (true) {
        delay(1000);  // Attendre 1 seconde
        double wind_speed_mph = pulse_count * FACTOR_MPH;
        double wind_speed_kmh = pulse_count * FACTOR_KMH;

        std::cout << "Vent : " << wind_speed_mph << " mph | " 
                  << wind_speed_kmh << " km/h" << std::endl;
        
        pulse_count = 0;  // Réinitialiser le compteur
    }
}


