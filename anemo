#include <wiringPi.h>
#include <iostream>

#define REED_PIN 0  // GPIO17 sur Raspberry Pi

volatile int pulseCount = 0;  // Compteur d'impulsions

// Fonction appelée à chaque front montant (détection 5V)
void pulseDetected() {
    pulseCount++;  // Incrémente le compteur d'impulsions
}

int main() {
    // Initialisation de WiringPi
    if (wiringPiSetup() == -1) {
        std::cerr << "Erreur d'initialisation de WiringPi" << std::endl;
        return 1;
    }

    // Configuration du pin GPIO en entrée avec résistance de pull-up
    pinMode(REED_PIN, INPUT);
    pullUpDnControl(REED_PIN, PUD_UP);

    // Configuration de l'interruption sur front montant
    wiringPiISR(REED_PIN, INT_EDGE_RISING, &pulseDetected);

    std::cout << "Test des impulsions... (Ctrl+C pour quitter)" << std::endl;

    // Boucle principale
    while (true) {
        std::cout << "Impulsions détectées : " << pulseCount << std::endl;
        delay(1000);  // Affiche le nombre d'impulsions chaque seconde
    }

    return 0;
}

